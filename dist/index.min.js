"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_MazeCell=require("./MazeCell"),_MazeCell2=_interopRequireDefault(_MazeCell),_directions=require("./directions.js"),_directions2=_interopRequireDefault(_directions),MazeGenerator=function(){function a(b,c){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0];_classCallCheck(this,a),this._width=b,this._height=c,this._maze=[],this._stack=[],this._start=d}return _createClass(a,[{key:"getNeighbour",value:function(a,b,c){switch(c){case _directions2["default"].LEFT:return a>0?this.getCell(a-1,b):null;case _directions2["default"].RIGHT:return a<this.Width-1?this.getCell(a+1,b):null;case _directions2["default"].UP:return b>0?this.getCell(a,b-1):null;case _directions2["default"].DOWN:return b<this.Height-1?this.getCell(a,b+1):null;default:throw new Error("No such direction:"+c)}}},{key:"getCell",value:function(a,b){if(0>a||0>b||a>this.Width-1||b>this.Height-1)return null;var c=this._maze[b*this.Width+a];return c||(c=new _MazeCell2["default"](a,b),this._setCell(a,b,c)),c}},{key:"generate",value:function(){this._stack=[],this._maze=[];var a=this.getCell(this.Start[0],this.Start[1]);return a.Visited=!0,this._gen_next(a),this.Maze}},{key:"opposingDir",value:function(a){switch(a){case _directions2["default"].LEFT:return _directions2["default"].RIGHT;case _directions2["default"].RIGHT:return _directions2["default"].LEFT;case _directions2["default"].UP:return _directions2["default"].DOWN;case _directions2["default"].DOWN:return _directions2["default"].UP}}},{key:"cellDirectionOpen",value:function(a,b){if(!a.HasWall(b)){var c=this.getNeighbour(a.X,a.Y,b);if(null===c)return console.log("no cell neigh",a),!1;var d=this.opposingDir(b);if(c.HasWall(d))throw new Error("Should not be possible");return!0}return!1}},{key:"_gen_next",value:function(a){var b=this._pickNeighbour(a);b?(this._stack.push(a),a.RemoveWall(b.dir),b.neigh.RemoveWall(this.opposingDir(b.dir)),b.neigh.Visited=!0,this._gen_next(b.neigh)):(b=this._stack.pop(),b&&this._gen_next(b))}},{key:"_setCell",value:function(a,b,c){return this._maze[b*this.Width+a]=c,c}},{key:"_pickNeighbour",value:function(a){var b=this,c=_directions2["default"].ALL,d=c.map(function(c){return{dir:c,neigh:b.getNeighbour(a.X,a.Y,c)}}).filter(function(a){return null!==a.neigh}).filter(function(a){return!a.neigh.Visited});if(0===d.length)return null;var e=~~(Math.random()*d.length),f=d[e];return f}},{key:"Width",get:function(){return this._width}},{key:"Height",get:function(){return this._height}},{key:"Start",get:function(){return this._start},set:function(a){this._start=[a[0],a[1]]}},{key:"Maze",get:function(){return this._maze}}]),a}();